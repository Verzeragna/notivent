<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ru.notivent.dao.TariffDao">

    <resultMap id="TariffWithPaymentParameters" type="ru.notivent.model.Tariff">
        <id column="t_id" property="uuid"/>
        <result column="name" property="name"/>
        <result column="subtitle" property="subtitle"/>
        <result column="type" property="type"/>
        <result column="price" property="price"/>
        <association property="paymentParameters" javaType="ru.notivent.model.PaymentParameters">
            <id column="p_id" property="uuid"/>
            <result column="client_application_key" property="clientApplicationKey"/>
            <result column="shop_id" property="shopId"/>
            <result column="auth_center_client_id" property="authCenterClientId"/>
        </association>
    </resultMap>

    <select id="findAll" resultType="ru.notivent.model.Tariff">
        SELECT *
        FROM mvp.tariff
    </select>

    <select id="findTariffWithPaymentParameters" resultMap="TariffWithPaymentParameters">
        SELECT
            t.uuid AS t_id,
            t.name,
            t.subtitle,
            t.type,
            t.price,
            pp.uuid AS p_id,
            pp.client_application_key,
            pp.shop_id,
            pp.auth_center_client_id
        FROM mvp.tariff t
        JOIN mvp.payment_parameters pp ON t.payment_parameters_uuid = pp.uuid
    </select>
</mapper>